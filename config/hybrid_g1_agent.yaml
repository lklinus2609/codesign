# Hybrid Co-Design Agent Configuration
# Based on amp_g1_agent.yaml with outer loop parameters for morphology optimization
#
# Algorithm 1: Hybrid PPO Control + Diff-Phys Morphology
# Reference: algorithm1.pdf

agent_name: "HybridAMP"

# ============================================================================
# Base AMP/PPO Configuration (Inner Loop)
# ============================================================================

model:
  actor_net: "fc_2layers_1024units"
  actor_init_output_scale: 0.01
  actor_std_type: "FIXED"
  action_std: 0.05

  critic_net: "fc_2layers_1024units"

  disc_net: "fc_2layers_1024units"

optimizer:
    type: "SGD"
    learning_rate: 5e-5

discount: 0.99
steps_per_iter: 32
iters_per_output: 100
test_episodes: 32
normalizer_samples: 100000000

update_epochs: 5
batch_size: 4
td_lambda: 0.95
ppo_clip_ratio: 0.2
norm_adv_clip: 4.0
action_bound_weight: 10.0
action_entropy_weight: 0.0
action_reg_weight: 0.0
critic_loss_weight: 1.0

# AMP Discriminator
disc_buffer_size: 200000
disc_replay_samples: 1000
disc_batch_size: 2048
disc_loss_weight: 5
disc_logit_reg: 0.01
disc_grad_penalty: 5
disc_weight_decay: 0.0001
disc_reward_scale: 2

task_reward_weight: 0.0
disc_reward_weight: 1.0

# ============================================================================
# Outer Loop Configuration (Morphology Optimization)
# Algorithm 1, Lines 19-24
# ============================================================================

# Number of inner loop iterations before outer loop activates
# This warmup period allows AMP to learn basic locomotion before morphology changes
# Recommendation: ~10000 iterations for stable walking
warmup_iters: 10000

# Frequency of outer loop updates (every N inner iterations)
# Lower values = more frequent morphology updates (may destabilize policy)
# Higher values = less frequent updates (slower design exploration)
outer_loop_freq: 200

# Learning rate for design parameter (beta in Algorithm 1, Line 24)
# phi_{k+1} = proj_C(phi_k - beta * grad_phi L)
design_learning_rate: 0.01

# Horizon for differentiable rollout (H in Algorithm 1, Line 21)
# Note: Keep this SHORT (<=5) to avoid contact force explosion in SolverSemiImplicit
# The robot falls and hits ground around step 3-4, causing instability
# Future work: Implement contact-stable differentiable solver or use finite differences
diff_horizon: 3

# ============================================================================
# Design Parameter Configuration
# ============================================================================

# Initial design parameter value (radians)
# 0.0 = neutral hip roll angle (feet parallel)
design_param_init: 0.0

# Bounds for design parameter (radians)
# ±10 degrees = ±0.1745 radians
design_param_min: -0.1745
design_param_max: 0.1745

# Use simplified differentiable rollout (no policy, just physics stability)
# Set to true for initial testing/debugging
use_simplified_diff: false

# ============================================================================
# Logging and Checkpointing
# ============================================================================

# Log design parameter history
log_design_history: true

# Save intermediate models during outer loop
save_outer_loop_models: true
